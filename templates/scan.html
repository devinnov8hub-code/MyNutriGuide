<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="theme-color" content="#0d6efd">
  <title>MyNutriguide â€” Scan</title>
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='logo2.png') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/scan.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/loader.css') }}">
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
</head>
<body>
  <div id="global-loader">
      <div class="logo-loader" id="loader">
          <img src="{{ url_for('static', filename='logo2.png') }}" class="logo-img logo-base" alt="Logo Base">
          
          <div class="logo-fill-wrapper" id="fillWrapper">
              <img src="{{ url_for('static', filename='logo2.png') }}" class="logo-img" alt="Logo Fill">
          </div>
      </div>
      <div id="loader-text" style="display: none; color: white; margin-top: 20px; font-size: 18px; font-weight: 500; text-align: center;">Analyzing...</div>
      
      <!-- Progress Bar -->
      <div id="loader-progress-container" class="progress-container" style="display: none;">
          <div id="loader-progress-bar" class="progress-bar"></div>
      </div>
  </div>

  <div class="scan-container">
    <!-- Camera Layer -->
    <div class="camera-view">
        <video id="video" autoplay playsinline></video>
        <canvas id="canvas" style="display: none;"></canvas>
        <img id="photo" alt="Captured photo" style="display: none;">
        <div id="focus-ring" class="focus-ring"></div>
    </div>

    <!-- UI Overlay -->
    <div class="ui-overlay">
        <!-- Top Bar -->
        <div class="top-bar">
            <a href="{{ url_for('main.dashboard') }}" class="back-btn" aria-label="Back">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </a>
            <div class="page-title">Scan Product</div>
            <div style="width: 40px;"></div> <!-- Spacer -->
        </div>

        <!-- Scan Frame -->
        <div class="scan-frame-container">
            <div class="scan-frame">
                <div class="corner tl"></div>
                <div class="corner tr"></div>
                <div class="corner bl"></div>
                <div class="corner br"></div>
            </div>
        </div>

        <!-- Post Capture Controls (Hidden initially) -->
        <div id="post-capture-controls" class="post-capture-actions" style="display: none;">
            <button id="retake-button" class="action-btn btn-retake">Retake</button>
            <button id="analyze-button" class="action-btn btn-analyze">Analyze</button>
        </div>

        <!-- Bottom Controls -->
        <div class="bottom-controls" id="camera-controls">
            <!-- Rotate Camera -->
            <button id="rotate-btn" class="control-btn btn-small" aria-label="Rotate Camera">
                <svg width="29" height="31" viewBox="0 0 29 31" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M14.3727 9.41309H8.00918C9.65481 7.96676 11.891 7.05832 14.3727 7.05832C18.9778 7.05832 22.7469 10.1303 23.3905 14.1226H28.6857C28.0222 7.52449 21.8776 2.35477 14.3794 2.35477C10.2387 2.35477 6.54271 3.95648 3.92828 6.47859V0L0 3.53215V12.9452H10.4511L14.3727 9.41309ZM18.2944 17.6548L14.3727 21.1869H20.7363C19.0906 22.6332 16.8544 23.5417 14.3727 23.5417C9.76762 23.5417 5.99859 20.4697 5.35494 16.4774H0.0663561C0.729917 23.0755 6.87449 28.2452 14.3727 28.2452C18.5133 28.2452 22.2094 26.6435 24.8238 24.1214V30.6L28.7455 27.0679V17.6548H18.2944Z" fill="#F6F6F6"/>
                </svg>

            </button>

            <!-- Capture -->
            <button id="capture-button" class="control-btn btn-large" aria-label="Capture">
                <svg width="57" height="50" viewBox="0 0 57 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M35.1641 0C35.8803 0.00211576 36.5799 0.220915 37.1699 0.626953C37.7597 1.03292 38.2129 1.60745 38.4707 2.27539L40.3555 7.11133H53.333C54.276 7.11133 55.1809 7.48555 55.8477 8.15234C56.5145 8.81914 56.8887 9.724 56.8887 10.667V46.2227C56.8886 47.1654 56.5143 48.0696 55.8477 48.7363C55.1809 49.4031 54.276 49.7773 53.333 49.7773H3.55566C2.61267 49.7773 1.70781 49.4031 1.04102 48.7363C0.374458 48.0697 0.000113118 47.1654 0 46.2227V10.667C0 9.72405 0.374285 8.81913 1.04102 8.15234C1.70781 7.48555 2.61267 7.11133 3.55566 7.11133H16.5332L18.4004 2.27539C18.6593 1.60447 19.1155 1.02731 19.709 0.621094C20.3025 0.214952 21.0055 -0.00147202 21.7246 0H35.1641ZM21.7246 3.55566L18.9688 10.667H3.55566V46.2227H53.333V10.667H37.9199L35.1641 3.55566H21.7246Z" fill="white"/>
                    <path d="M35.1641 0C35.8803 0.00211576 36.5799 0.220915 37.1699 0.626953C37.7597 1.03292 38.2129 1.60745 38.4707 2.27539L40.3555 7.11133H53.333C54.276 7.11133 55.1809 7.48555 55.8477 8.15234C56.5145 8.81914 56.8887 9.724 56.8887 10.667V46.2227C56.8886 47.1654 56.5143 48.0696 55.8477 48.7363C55.1809 49.4031 54.276 49.7773 53.333 49.7773H3.55566C2.61267 49.7773 1.70781 49.4031 1.04102 48.7363C0.374458 48.0697 0.000113118 47.1654 0 46.2227V10.667C0 9.72405 0.374285 8.81913 1.04102 8.15234C1.70781 7.48555 2.61267 7.11133 3.55566 7.11133H16.5332L18.4004 2.27539C18.6593 1.60447 19.1155 1.02731 19.709 0.621094C20.3025 0.214952 21.0055 -0.00147202 21.7246 0H35.1641ZM21.7246 3.55566L18.9688 10.667H3.55566V46.2227H53.333V10.667H37.9199L35.1641 3.55566H21.7246Z" stroke="white"/>
                    <path d="M28.4443 10.6667C31.6087 10.6667 34.7019 11.605 37.333 13.363C39.9642 15.1211 42.0156 17.62 43.2266 20.5436C44.4375 23.4672 44.754 26.6842 44.1367 29.7878C43.5194 32.8915 41.9955 35.7425 39.7578 37.9802C37.5202 40.2178 34.6691 41.7417 31.5654 42.3591C28.4618 42.9764 25.2448 42.6599 22.3213 41.4489C19.3977 40.2379 16.8987 38.1865 15.1406 35.5554C13.3827 32.9243 12.4443 29.831 12.4443 26.6667C12.4443 22.4232 14.1303 18.3538 17.1309 15.3532C20.1314 12.3526 24.2009 10.6667 28.4443 10.6667ZM28.4443 13.5114C25.8425 13.5114 23.2991 14.2827 21.1357 15.7282C18.9723 17.1738 17.2858 19.2286 16.29 21.6325C15.2944 24.0363 15.0344 26.6813 15.542 29.2331C16.0496 31.785 17.3018 34.1296 19.1416 35.9694C20.9814 37.8093 23.326 39.0614 25.8779 39.569C28.4298 40.0766 31.0747 39.8166 33.4785 38.821C35.8824 37.8253 37.9373 36.1387 39.3828 33.9753C40.8283 31.8119 41.5996 29.2685 41.5996 26.6667C41.5949 23.1791 40.2073 19.8359 37.7412 17.3698C35.2751 14.9037 31.932 13.5161 28.4443 13.5114Z" fill="white"/>
                    <path d="M28.4443 10.6667C31.6087 10.6667 34.7019 11.605 37.333 13.363C39.9642 15.1211 42.0156 17.62 43.2266 20.5436C44.4375 23.4672 44.754 26.6842 44.1367 29.7878C43.5194 32.8915 41.9955 35.7425 39.7578 37.9802C37.5202 40.2178 34.6691 41.7417 31.5654 42.3591C28.4618 42.9764 25.2448 42.6599 22.3213 41.4489C19.3977 40.2379 16.8987 38.1865 15.1406 35.5554C13.3827 32.9243 12.4443 29.831 12.4443 26.6667C12.4443 22.4232 14.1303 18.3538 17.1309 15.3532C20.1314 12.3526 24.2009 10.6667 28.4443 10.6667ZM28.4443 13.5114C25.8425 13.5114 23.2991 14.2827 21.1357 15.7282C18.9723 17.1738 17.2858 19.2286 16.29 21.6325C15.2944 24.0363 15.0344 26.6813 15.542 29.2331C16.0496 31.785 17.3018 34.1296 19.1416 35.9694C20.9814 37.8093 23.326 39.0614 25.8779 39.569C28.4298 40.0766 31.0747 39.8166 33.4785 38.821C35.8824 37.8253 37.9373 36.1387 39.3828 33.9753C40.8283 31.8119 41.5996 29.2685 41.5996 26.6667C41.5949 23.1791 40.2073 19.8359 37.7412 17.3698C35.2751 14.9037 31.932 13.5161 28.4443 13.5114Z" stroke="white"/>
                    <path d="M11.6794 14.2756C12.0566 14.2756 12.4186 14.4258 12.6853 14.6926C12.9519 14.9592 13.1022 15.3204 13.1023 15.6974C13.1023 16.0746 12.952 16.4366 12.6853 16.7033C12.4186 16.97 12.0566 17.1203 11.6794 17.1203H7.41284C7.03584 17.1202 6.67458 16.9699 6.40796 16.7033C6.14124 16.4366 5.99097 16.0746 5.99097 15.6974C5.99106 15.3204 6.14132 14.9592 6.40796 14.6926C6.6746 14.4259 7.03577 14.2757 7.41284 14.2756H11.6794Z" fill="white"/>
                    <path d="M11.6794 14.2756C12.0566 14.2756 12.4186 14.4258 12.6853 14.6926C12.9519 14.9592 13.1022 15.3204 13.1023 15.6974C13.1023 16.0746 12.952 16.4366 12.6853 16.7033C12.4186 16.97 12.0566 17.1203 11.6794 17.1203H7.41284C7.03584 17.1202 6.67458 16.9699 6.40796 16.7033C6.14124 16.4366 5.99097 16.0746 5.99097 15.6974C5.99106 15.3204 6.14132 14.9592 6.40796 14.6926C6.6746 14.4259 7.03577 14.2757 7.41284 14.2756H11.6794Z" stroke="white"/>
                    <path d="M23.9805 17.6887C25.6682 16.8766 27.5518 16.5605 29.4121 16.7776C31.2724 16.9947 33.033 17.7363 34.4883 18.9153L32.96 21.3694C32.2039 20.6072 31.2851 20.0256 30.2725 19.6692C29.2598 19.3128 28.1791 19.1902 27.1123 19.3108C26.0458 19.4314 25.0206 19.7922 24.1133 20.3655C23.2057 20.9389 22.4389 21.7106 21.8721 22.6223C21.3054 23.5338 20.9527 24.5618 20.8398 25.6292C20.727 26.6967 20.857 27.7764 21.2207 28.7864C21.5845 29.7964 22.1728 30.7107 22.9404 31.4612C23.708 32.2117 24.6353 32.7794 25.6533 33.1204L24.1426 35.5559C22.4394 34.7716 20.9933 33.5191 19.9736 31.9456C18.9541 30.3721 18.4018 28.5411 18.3818 26.6663C18.3685 24.7933 18.8879 22.9548 19.8789 21.3655C20.87 19.7761 22.2927 18.5009 23.9805 17.6887Z" fill="white"/>
                    <path d="M23.9805 17.6887C25.6682 16.8766 27.5518 16.5605 29.4121 16.7776C31.2724 16.9947 33.033 17.7363 34.4883 18.9153L32.96 21.3694C32.2039 20.6072 31.2851 20.0256 30.2725 19.6692C29.2598 19.3128 28.1791 19.1902 27.1123 19.3108C26.0458 19.4314 25.0206 19.7922 24.1133 20.3655C23.2057 20.9389 22.4389 21.7106 21.8721 22.6223C21.3054 23.5338 20.9527 24.5618 20.8398 25.6292C20.727 26.6967 20.857 27.7764 21.2207 28.7864C21.5845 29.7964 22.1728 30.7107 22.9404 31.4612C23.708 32.2117 24.6353 32.7794 25.6533 33.1204L24.1426 35.5559C22.4394 34.7716 20.9933 33.5191 19.9736 31.9456C18.9541 30.3721 18.4018 28.5411 18.3818 26.6663C18.3685 24.7933 18.8879 22.9548 19.8789 21.3655C20.87 19.7761 22.2927 18.5009 23.9805 17.6887Z" stroke="white"/>
                </svg>

            </button>

            <!-- Upload -->
            <button id="upload-btn" class="control-btn btn-small" aria-label="Upload Image">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="17 8 12 3 7 8"/>
                    <line x1="12" y1="3" x2="12" y2="15"/>
                </svg>
            </button>
            <input type="file" id="file-input" accept="image/*" style="display: none;">
        </div>
    </div>

    <!-- Error Message -->
    <div id="error-message" class="alert alert-danger" style="display: none; background: #f8d7da; color: #721c24; padding: 10px; border-radius: 8px;"></div>
  </div>

  <script src="{{ url_for('static', filename='js/camera.js') }}"></script>
  <script src="{{ url_for('static', filename='js/loader.js') }}"></script>
  <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register("{{ url_for('static', filename='sw.js') }}");
        });
      }
  </script>
</body>
</html>
